{% extends 'patientdashboard/patient_base.html' %}
{% load static %}

{% block title %}Bills & Payments - Patient Dashboard{% endblock %}

{% block content %}
<!-- Modern Bills Header -->
<div class="bg-gradient-to-r from-patient-purple to-purple-600 rounded-2xl p-6 mb-8 text-white">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
        <div>
            <h1 class="text-2xl md:text-3xl font-bold mb-2" data-translate="Bills & Payments">Bills & Payments</h1>
            <p class="text-white/90" data-translate="Manage your medical bills and payment history">Manage your medical bills and payment history</p>
        </div>
        <div class="mt-4 md:mt-0">
            <div class="flex items-center space-x-4">
                <div class="text-center">
                    <div class="text-2xl font-bold">{{ bills.count }}</div>
                    <div class="text-sm text-white/80" data-translate="Total Bills">Total Bills</div>
                </div>
                <div class="w-px h-12 bg-white/20"></div>
                <div class="text-center">
                    <div class="text-2xl font-bold">${{ total_amount|default:0 }}</div>
                    <div class="text-sm text-white/80" data-translate="Total Amount">Total Amount</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Stats -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 patient-card">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-patient-dark-gray text-sm font-medium" data-translate="Paid Bills">Paid Bills</p>
                <p class="text-2xl font-bold text-patient-green">{{ paid_bills|default:0 }}</p>
            </div>
            <div class="w-12 h-12 bg-gradient-to-br from-patient-green to-green-600 rounded-xl flex items-center justify-center">
                <i class="fas fa-check-circle text-white text-lg"></i>
            </div>
        </div>
    </div>
    
    <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 patient-card">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-patient-dark-gray text-sm font-medium" data-translate="Pending">Pending</p>
                <p class="text-2xl font-bold text-patient-orange">{{ pending_bills|default:0 }}</p>
            </div>
            <div class="w-12 h-12 bg-gradient-to-br from-patient-orange to-orange-600 rounded-xl flex items-center justify-center">
                <i class="fas fa-clock text-white text-lg"></i>
            </div>
        </div>
    </div>
    
    <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 patient-card">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-patient-dark-gray text-sm font-medium" data-translate="This Month">This Month</p>
                <p class="text-2xl font-bold text-patient-blue">${{ month_total|default:0 }}</p>
            </div>
            <div class="w-12 h-12 bg-gradient-to-br from-patient-blue to-patient-dark-blue rounded-xl flex items-center justify-center">
                <i class="fas fa-calendar-alt text-white text-lg"></i>
            </div>
        </div>
    </div>
    
    <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100 patient-card">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-patient-dark-gray text-sm font-medium" data-translate="Average Bill">Average Bill</p>
                <p class="text-2xl font-bold text-patient-purple">${{ average_bill|default:0 }}</p>
            </div>
            <div class="w-12 h-12 bg-gradient-to-br from-patient-purple to-purple-600 rounded-xl flex items-center justify-center">
                <i class="fas fa-chart-line text-white text-lg"></i>
            </div>
        </div>
    </div>
</div>

<!-- Bills List -->
<div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
    <div class="p-6 border-b border-gray-200">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
            <div>
                <h2 class="text-xl font-bold text-patient-dark-blue" data-translate="Billing History">Billing History</h2>
                <p class="text-patient-dark-gray mt-1" data-translate="View and manage your medical bills">View and manage your medical bills</p>
            </div>
            <div class="mt-4 md:mt-0 flex space-x-3">
                <button class="px-4 py-2 bg-patient-blue/10 text-patient-blue rounded-lg hover:bg-patient-blue/20 transition-colors">
                    <i class="fas fa-filter mr-2"></i><span data-translate="Filter">Filter</span>
                </button>
                <button class="px-4 py-2 bg-patient-green/10 text-patient-green rounded-lg hover:bg-patient-green/20 transition-colors">
                    <i class="fas fa-download mr-2"></i><span data-translate="Export">Export</span>
                </button>
            </div>
        </div>
    </div>
    
    {% if bills %}
    <!-- Desktop Table View -->
    <div class="hidden lg:block overflow-x-auto">
        <table class="w-full">
            <thead class="bg-patient-gray">
                <tr>
                    <th class="px-6 py-4 text-left text-sm font-semibold text-patient-dark-blue">Invoice #</th>
                    <th class="px-6 py-4 text-left text-sm font-semibold text-patient-dark-blue">Date</th>
                    <th class="px-6 py-4 text-left text-sm font-semibold text-patient-dark-blue">Doctor</th>
                    <th class="px-6 py-4 text-left text-sm font-semibold text-patient-dark-blue">Service</th>
                    <th class="px-6 py-4 text-left text-sm font-semibold text-patient-dark-blue">Amount</th>
                    <th class="px-6 py-4 text-left text-sm font-semibold text-patient-dark-blue">Status</th>
                    <th class="px-6 py-4 text-left text-sm font-semibold text-patient-dark-blue">Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                {% for bill in bills %}
                <tr class="hover:bg-patient-light-blue/30 transition-colors">
                    <td class="px-6 py-4">
                        <div class="font-medium text-patient-dark-blue">{{ bill.invoice_number }}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-patient-dark-blue">{{ bill.issued_date|date:"M d, Y" }}</div>
                        <div class="text-sm text-patient-dark-gray">{{ bill.issued_date|time:"h:i A" }}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-gradient-to-br from-patient-blue to-patient-dark-blue rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-user-md text-white text-sm"></i>
                            </div>
                            <div>
                                <div class="font-medium text-patient-dark-blue">
                                    Dr. {{ bill.appointment.practitioner.first_name }} {{ bill.appointment.practitioner.last_name }}
                                </div>
                                <div class="text-sm text-patient-dark-gray">{{ bill.appointment.practitioner.specialization|default:"General Practice" }}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-patient-dark-blue">Consultation</div>
                        <div class="text-sm text-patient-dark-gray">{{ bill.appointment.created_at|date:"M d, Y" }}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-xl font-bold text-patient-dark-blue">${{ bill.amount|floatformat:0 }}</div>
                    </td>
                    <td class="px-6 py-4">
                        {% if bill.is_paid %}
                        <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">
                            <i class="fas fa-check-circle mr-1"></i>Paid
                        </span>
                        {% else %}
                        <span class="px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm font-medium">
                            <i class="fas fa-clock mr-1"></i>Pending
                        </span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex space-x-2">
                            <a href="{% url 'patientdashboard:view_bill' bill.id %}" 
                               class="px-3 py-2 bg-patient-blue text-white rounded-lg hover:bg-patient-dark-blue transition-colors text-sm">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="#" 
                               class="px-3 py-2 bg-patient-green text-white rounded-lg hover:bg-green-700 transition-colors text-sm">
                                <i class="fas fa-download"></i>
                            </a>
                            {% if not bill.is_paid %}
                            <a href="#" 
                               class="px-3 py-2 bg-patient-purple text-white rounded-lg hover:bg-purple-700 transition-colors text-sm">
                                <i class="fas fa-credit-card"></i>
                            </a>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Mobile Card View -->
    <div class="lg:hidden p-6 space-y-4">
        {% for bill in bills %}
        <div class="bg-patient-gray rounded-xl p-4 border border-gray-200">
            <div class="flex justify-between items-start mb-3">
                <div>
                    <h3 class="font-bold text-patient-dark-blue">{{ bill.invoice_number }}</h3>
                    <p class="text-sm text-patient-dark-gray">{{ bill.issued_date|date:"M d, Y" }}</p>
                </div>
                <div class="text-right">
                    <div class="text-xl font-bold text-patient-dark-blue">${{ bill.amount|floatformat:0 }}</div>
                    {% if bill.is_paid %}
                    <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">Paid</span>
                    {% else %}
                    <span class="px-2 py-1 bg-orange-100 text-orange-800 rounded-full text-xs font-medium">Pending</span>
                    {% endif %}
                </div>
            </div>
            
            <div class="flex items-center mb-3">
                <div class="w-8 h-8 bg-gradient-to-br from-patient-blue to-patient-dark-blue rounded-full flex items-center justify-center mr-3">
                    <i class="fas fa-user-md text-white text-xs"></i>
                </div>
                <div>
                    <div class="font-medium text-patient-dark-blue text-sm">
                        Dr. {{ bill.appointment.practitioner.first_name }} {{ bill.appointment.practitioner.last_name }}
                    </div>
                    <div class="text-xs text-patient-dark-gray">Consultation</div>
                </div>
            </div>
            
            <div class="flex space-x-2">
                <a href="{% url 'patientdashboard:view_bill' bill.id %}" 
                   class="flex-1 px-3 py-2 bg-patient-blue text-white rounded-lg hover:bg-patient-dark-blue transition-colors text-sm text-center">
                    View Details
                </a>
                {% if not bill.is_paid %}
                <a href="#" 
                   class="flex-1 px-3 py-2 bg-patient-green text-white rounded-lg hover:bg-green-700 transition-colors text-sm text-center">
                    Pay Now
                </a>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    
    {% else %}
    <!-- Empty State -->
    <div class="text-center py-16">
        <div class="w-24 h-24 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-6">
            <i class="fas fa-file-invoice-dollar text-patient-purple text-4xl"></i>
        </div>
        <h3 class="text-2xl font-semibold text-patient-dark-blue mb-4">No Bills Found</h3>
        <p class="text-patient-dark-gray mb-8 max-w-md mx-auto">
            You don't have any billing records yet. Bills will appear here after your appointments.
        </p>
        <a href="{% url 'patient_dashboard:specialty_selection' %}" 
           class="inline-flex items-center px-6 py-3 bg-patient-purple text-white rounded-xl hover:bg-purple-700 transition-colors font-semibold">
            <i class="fas fa-calendar-plus mr-2"></i>Book Your First Appointment
        </a>
    </div>
    {% endif %}
</div>

<script>
// Initialize cards animation
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.patient-card');
    cards.forEach((card, index) => {
        setTimeout(() => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'all 0.5s ease';
            
            setTimeout(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 100);
        }, index * 100);
    });
});
</script>
{% endblock %}