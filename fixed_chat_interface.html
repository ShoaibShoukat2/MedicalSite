<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fixed Chat Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Typing animation */
        @keyframes typing {
            0%, 60%, 100% { 
                transform: translateY(0); 
                opacity: 0.4; 
            }
            30% { 
                transform: translateY(-8px); 
                opacity: 1; 
            }
        }

        .animate-typing {
            animation: typing 1.4s infinite;
        }

        /* Send button animation */
        @keyframes sendPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .send-pulse {
            animation: sendPulse 0.3s ease-in-out;
        }

        /* Message slide animation */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-slide-in {
            animation: slideInUp 0.3s ease-out;
        }

        /* Improved scrollbar */
        .scrollbar-thin {
            scrollbar-width: thin;
            scrollbar-color: #CBD5E1 #F1F5F9;
        }

        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }

        .scrollbar-thin::-webkit-scrollbar-track {
            background: #F1F5F9;
            border-radius: 3px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #CBD5E1;
            border-radius: 3px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: #94A3B8;
        }

        /* Input focus effects */
        .chat-input:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            border-color: #3B82F6;
        }

        /* Message status */
        .message-sending {
            opacity: 0.7;
        }

        .message-sent {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto p-4 max-w-4xl">
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden" style="height: 80vh;">
            <!-- Chat Header -->
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center text-white font-bold">
                        D
                    </div>
                    <div>
                        <h2 class="font-bold text-lg">Dr. Test Doctor</h2>
                        <div class="flex items-center space-x-2 text-sm opacity-90">
                            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                            <span>Online</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Messages Container -->
            <div class="flex-1 overflow-y-auto p-4 space-y-4 scrollbar-thin bg-gray-50" 
                 id="messages-container" 
                 style="height: calc(80vh - 200px);">
                <!-- Messages will be added here -->
            </div>

            <!-- Typing Indicator -->
            <div id="typing-indicator" class="hidden px-4 pb-2">
                <div class="flex justify-start">
                    <div class="bg-white rounded-2xl rounded-bl-md px-4 py-3 shadow-sm border">
                        <div class="flex space-x-1 items-center">
                            <div class="w-2 h-2 bg-gray-500 rounded-full animate-typing"></div>
                            <div class="w-2 h-2 bg-gray-500 rounded-full animate-typing" style="animation-delay: 0.2s"></div>
                            <div class="w-2 h-2 bg-gray-500 rounded-full animate-typing" style="animation-delay: 0.4s"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Message Input -->
            <div class="bg-white border-t border-gray-200 p-4">
                <form id="chat-form" class="flex items-center space-x-3">
                    <div class="flex-1 relative">
                        <input type="text" 
                               id="message-input" 
                               placeholder="Type your message..." 
                               class="chat-input w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300"
                               autocomplete="off"
                               maxlength="1000">
                    </div>
                    
                    <button type="submit" 
                            id="send-button"
                            class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-full flex items-center justify-center hover:shadow-lg transform hover:scale-105 active:scale-95 transition-all duration-300 disabled:opacity-50">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
                
                <!-- Quick Replies -->
                <div class="flex flex-wrap gap-2 mt-3">
                    <button class="quick-reply px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-blue-500 hover:text-white transition-colors" data-message="Thank you!">
                        üëç Thank you!
                    </button>
                    <button class="quick-reply px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-green-500 hover:text-white transition-colors" data-message="I understand">
                        ‚úÖ I understand
                    </button>
                    <button class="quick-reply px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-purple-500 hover:text-white transition-colors" data-message="Can we schedule a call?">
                        üìû Schedule call
                    </button>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="mt-4 text-center text-sm text-gray-500">
            Status: <span id="status" class="font-semibold text-green-600">Ready</span> | 
            Messages: <span id="message-count">0</span>
        </div>
    </div>

    <script>
        // Global variables
        let messageCount = 0;
        let isSending = false;

        // DOM elements
        const chatForm = document.getElementById('chat-form');
        const messageInput = document.getElementById('message-input');
        const messagesContainer = document.getElementById('messages-container');
        const sendButton = document.getElementById('send-button');
        const typingIndicator = document.getElementById('typing-indicator');
        const statusElement = document.getElementById('status');
        const messageCountElement = document.getElementById('message-count');

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ Chat interface loaded');
            updateStatus('Ready');
            
            // Add welcome message
            addMessage(false, "Hello! How can I help you today?");
            
            // Focus on input
            messageInput.focus();
        });

        // Form submission
        chatForm.addEventListener('submit', function(e) {
            e.preventDefault();
            sendMessage();
        });

        // Enter key to send
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey && !isSending) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Quick replies
        document.querySelectorAll('.quick-reply').forEach(btn => {
            btn.addEventListener('click', function() {
                const message = this.getAttribute('data-message');
                if (message && !isSending) {
                    messageInput.value = message;
                    sendMessage();
                }
            });
        });

        // Send message function
        function sendMessage() {
            const message = messageInput.value.trim();
            
            if (!message || isSending) {
                return;
            }

            // Prevent double sending
            isSending = true;
            
            // Update UI
            sendButton.disabled = true;
            sendButton.classList.add('send-pulse');
            updateStatus('Sending...');
            
            // Clear input
            messageInput.value = '';
            
            // Add message to UI
            addMessage(true, message);
            
            // Simulate sending delay
            setTimeout(() => {
                // Reset button
                sendButton.disabled = false;
                sendButton.classList.remove('send-pulse');
                updateStatus('Sent');
                isSending = false;
                
                // Focus back on input
                messageInput.focus();
                
                // Simulate response
                simulateResponse();
                
            }, 500);
        }

        // Add message to UI
        function addMessage(isSent, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-slide-in ${isSent ? 'flex justify-end' : 'flex justify-start'}`;
            
            const currentTime = new Date().toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: 'numeric', 
                hour12: true 
            });

            const bubbleClass = isSent 
                ? 'bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-2xl rounded-br-md' 
                : 'bg-white border border-gray-200 text-gray-800 rounded-2xl rounded-bl-md';

            messageDiv.innerHTML = `
                <div class="max-w-xs lg:max-w-md">
                    <div class="${bubbleClass} px-4 py-3 shadow-sm">
                        <p class="text-sm leading-relaxed">${escapeHtml(content)}</p>
                    </div>
                    <div class="flex ${isSent ? 'justify-end' : 'justify-start'} mt-1">
                        <span class="text-xs text-gray-500">${currentTime}</span>
                        ${isSent ? '<i class="fas fa-check-double text-blue-500 text-xs ml-1"></i>' : ''}
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
            
            messageCount++;
            updateMessageCount();
        }

        // Simulate typing and response
        function simulateResponse() {
            setTimeout(() => {
                showTyping();
                
                setTimeout(() => {
                    hideTyping();
                    
                    const responses = [
                        "I understand your concern.",
                        "That's a good question.",
                        "Let me help you with that.",
                        "I see what you mean.",
                        "Thank you for sharing that information."
                    ];
                    
                    const response = responses[Math.floor(Math.random() * responses.length)];
                    addMessage(false, response);
                    updateStatus('Ready');
                    
                }, 2000);
            }, 1000);
        }

        // Show typing indicator
        function showTyping() {
            typingIndicator.classList.remove('hidden');
            scrollToBottom();
            updateStatus('Doctor is typing...');
        }

        // Hide typing indicator
        function hideTyping() {
            typingIndicator.classList.add('hidden');
        }

        // Utility functions
        function scrollToBottom() {
            messagesContainer.scrollTo({
                top: messagesContainer.scrollHeight,
                behavior: 'smooth'
            });
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }

        function updateStatus(status) {
            statusElement.textContent = status;
            console.log(`Status: ${status}`);
        }

        function updateMessageCount() {
            messageCountElement.textContent = messageCount;
        }
    </script>
</body>
</html>