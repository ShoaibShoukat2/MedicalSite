<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Practitioner Chat Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Practitioner-specific styling */
        .practitioner-sent {
            background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .patient-received {
            background: #F0F9FF;
            border: 1px solid #E0F2FE;
            color: #0F172A;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        /* Enhanced animations */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.98);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .animate-slide-up {
            animation: slideInUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Typing animation */
        @keyframes typing {
            0%, 60%, 100% { 
                transform: translateY(0); 
                opacity: 0.4; 
            }
            30% { 
                transform: translateY(-6px); 
                opacity: 1; 
            }
        }

        .animate-typing {
            animation: typing 1.4s infinite;
        }

        /* Send button animation */
        @keyframes sendPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .send-pulse {
            animation: sendPulse 0.3s ease-in-out;
        }

        /* Improved scrollbar */
        .scrollbar-thin {
            scrollbar-width: thin;
            scrollbar-color: #CBD5E1 #F1F5F9;
        }

        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }

        .scrollbar-thin::-webkit-scrollbar-track {
            background: #F1F5F9;
            border-radius: 3px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #CBD5E1;
            border-radius: 3px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: #94A3B8;
        }

        /* Input focus effects */
        .chat-input:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            border-color: #3B82F6;
        }

        /* Practitioner theme */
        .practitioner-header {
            background: linear-gradient(135deg, #1E40AF 0%, #1D4ED8 100%);
        }

        .practitioner-sidebar {
            background: linear-gradient(180deg, #F8FAFC 0%, #F1F5F9 100%);
        }

        /* Patient avatar styling */
        .patient-avatar {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        }

        /* Message status indicators */
        .message-delivered {
            color: #10B981;
        }

        .message-read {
            color: #3B82F6;
        }

        /* Professional styling */
        .professional-card {
            background: white;
            border: 1px solid #E5E7EB;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .professional-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto p-4 max-w-7xl">
        <!-- Header -->
        <div class="professional-card rounded-2xl p-6 mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">
                        <i class="fas fa-stethoscope text-blue-600 mr-3"></i>
                        Patient Communication Center
                    </h1>
                    <p class="text-gray-600">Secure messaging with your patients</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="bg-green-100 text-green-800 px-4 py-2 rounded-full text-sm font-semibold">
                        <i class="fas fa-circle text-green-500 mr-2"></i>
                        Online
                    </div>
                    <div class="bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm font-semibold">
                        <i class="fas fa-shield-alt mr-2"></i>
                        HIPAA Compliant
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Interface -->
        <div class="professional-card rounded-2xl overflow-hidden" style="height: 75vh;">
            <div class="flex h-full">
                <!-- Patient List Sidebar -->
                <div class="w-80 practitioner-sidebar border-r border-gray-200 flex flex-col">
                    <!-- Search -->
                    <div class="p-4 border-b border-gray-200 bg-white">
                        <div class="relative">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            <input type="text" 
                                   placeholder="Search patients..." 
                                   class="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300"
                                   id="search-input">
                        </div>
                    </div>

                    <!-- Patient List -->
                    <div class="flex-1 overflow-y-auto p-2">
                        <!-- Sample Patient Items -->
                        <div class="patient-item professional-card p-4 rounded-xl cursor-pointer border-l-4 border-transparent hover:border-blue-500 transition-all duration-300 mb-2 active bg-blue-50 border-blue-500"
                             onclick="selectPatient('John Smith', 'JS')"
                             data-patient-id="1">
                            <div class="flex items-center space-x-3">
                                <div class="patient-avatar w-12 h-12 rounded-full flex items-center justify-center text-white font-bold shadow-md">
                                    JS
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center justify-between mb-1">
                                        <h3 class="font-semibold text-gray-900 truncate text-sm">John Smith</h3>
                                        <span class="text-xs text-gray-500">2 min ago</span>
                                    </div>
                                    <p class="text-xs text-gray-600 truncate">helo buddy</p>
                                    <div class="flex items-center justify-between mt-1">
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-green-100 text-green-800">
                                            <i class="fas fa-user-injured mr-1"></i>
                                            Patient
                                        </span>
                                        <span class="bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold">
                                            2
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="patient-item professional-card p-4 rounded-xl cursor-pointer border-l-4 border-transparent hover:border-blue-500 transition-all duration-300 mb-2"
                             onclick="selectPatient('Sarah Johnson', 'SJ')"
                             data-patient-id="2">
                            <div class="flex items-center space-x-3">
                                <div class="patient-avatar w-12 h-12 rounded-full flex items-center justify-center text-white font-bold shadow-md">
                                    SJ
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center justify-between mb-1">
                                        <h3 class="font-semibold text-gray-900 truncate text-sm">Sarah Johnson</h3>
                                        <span class="text-xs text-gray-500">1 hour ago</span>
                                    </div>
                                    <p class="text-xs text-gray-600 truncate">Thank you for the consultation</p>
                                    <div class="mt-1">
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-green-100 text-green-800">
                                            <i class="fas fa-user-injured mr-1"></i>
                                            Patient
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Area -->
                <div class="flex-1 flex flex-col bg-white">
                    <!-- Chat Header -->
                    <div class="practitioner-header text-white p-4 flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="patient-avatar w-12 h-12 rounded-full flex items-center justify-center text-white font-bold shadow-lg">
                                <span id="patient-avatar">JS</span>
                            </div>
                            <div>
                                <h2 class="font-bold text-lg" id="patient-name">John Smith</h2>
                                <div class="flex items-center space-x-2 text-sm opacity-90">
                                    <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                    <span>Patient Online</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center hover:bg-opacity-30 transition-all duration-300" title="Patient Records">
                                <i class="fas fa-file-medical"></i>
                            </button>
                            <button class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center hover:bg-opacity-30 transition-all duration-300" title="Video Call">
                                <i class="fas fa-video"></i>
                            </button>
                            <button class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center hover:bg-opacity-30 transition-all duration-300" title="Voice Call">
                                <i class="fas fa-phone"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Messages Container -->
                    <div class="flex-1 overflow-y-auto p-4 space-y-4 scrollbar-thin bg-gradient-to-b from-gray-50 to-white" id="messages-container">
                        <!-- Sample Messages -->
                        <div class="message-item animate-slide-up flex justify-start">
                            <div class="max-w-xs lg:max-w-md">
                                <div class="patient-received rounded-2xl rounded-bl-md px-4 py-3 shadow-sm">
                                    <p class="text-sm leading-relaxed">I understand</p>
                                </div>
                                <div class="flex justify-start mt-1">
                                    <span class="text-xs text-gray-500">9:14 AM</span>
                                </div>
                            </div>
                        </div>

                        <div class="message-item animate-slide-up flex justify-start">
                            <div class="max-w-xs lg:max-w-md">
                                <div class="patient-received rounded-2xl rounded-bl-md px-4 py-3 shadow-sm">
                                    <p class="text-sm leading-relaxed">Can we schedule a call?</p>
                                </div>
                                <div class="flex justify-start mt-1">
                                    <span class="text-xs text-gray-500">9:14 AM</span>
                                </div>
                            </div>
                        </div>

                        <div class="message-item animate-slide-up flex justify-end">
                            <div class="max-w-xs lg:max-w-md">
                                <div class="practitioner-sent text-white rounded-2xl rounded-br-md px-4 py-3 shadow-lg">
                                    <p class="text-sm leading-relaxed">okay . let me start</p>
                                </div>
                                <div class="flex justify-end mt-1 items-center space-x-1">
                                    <span class="text-xs text-gray-500">9:16 AM</span>
                                    <i class="fas fa-check-double message-read text-xs" title="Read"></i>
                                </div>
                            </div>
                        </div>

                        <div class="message-item animate-slide-up flex justify-start">
                            <div class="max-w-xs lg:max-w-md">
                                <div class="patient-received rounded-2xl rounded-bl-md px-4 py-3 shadow-sm">
                                    <p class="text-sm leading-relaxed">hi there</p>
                                </div>
                                <div class="flex justify-start mt-1">
                                    <span class="text-xs text-gray-500">1:12 PM</span>
                                </div>
                            </div>
                        </div>

                        <div class="message-item animate-slide-up flex justify-start">
                            <div class="max-w-xs lg:max-w-md">
                                <div class="patient-received rounded-2xl rounded-bl-md px-4 py-3 shadow-sm">
                                    <p class="text-sm leading-relaxed">helo buddy</p>
                                </div>
                                <div class="flex justify-start mt-1">
                                    <span class="text-xs text-gray-500">1:26 PM</span>
                                </div>
                            </div>
                        </div>

                        <div class="message-item animate-slide-up flex justify-end">
                            <div class="max-w-xs lg:max-w-md">
                                <div class="practitioner-sent text-white rounded-2xl rounded-br-md px-4 py-3 shadow-lg">
                                    <p class="text-sm leading-relaxed">hi i am here</p>
                                </div>
                                <div class="flex justify-end mt-1 items-center space-x-1">
                                    <span class="text-xs text-gray-500">2:38 PM</span>
                                    <i class="fas fa-check-double message-read text-xs" title="Read"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Typing Indicator -->
                    <div id="typing-indicator" class="hidden px-4 pb-2">
                        <div class="flex justify-start">
                            <div class="max-w-xs lg:max-w-md">
                                <div class="patient-received rounded-2xl rounded-bl-md px-4 py-3 shadow-sm">
                                    <div class="flex space-x-1 items-center">
                                        <div class="w-2 h-2 bg-gray-500 rounded-full animate-typing"></div>
                                        <div class="w-2 h-2 bg-gray-500 rounded-full animate-typing" style="animation-delay: 0.2s"></div>
                                        <div class="w-2 h-2 bg-gray-500 rounded-full animate-typing" style="animation-delay: 0.4s"></div>
                                    </div>
                                </div>
                                <div class="flex justify-start mt-1">
                                    <span class="text-xs text-gray-500 italic">Patient is typing...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Message Input -->
                    <div class="bg-white border-t border-gray-200 p-4 shadow-lg">
                        <form id="chat-form" class="flex items-end space-x-3">
                            <button type="button" class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center hover:bg-blue-500 hover:text-white transition-all duration-300 group" title="Attach File">
                                <i class="fas fa-paperclip text-sm group-hover:rotate-12 transition-transform duration-300"></i>
                            </button>
                            
                            <div class="flex-1 relative">
                                <input type="text" 
                                       id="message-input" 
                                       placeholder="Type your professional response..." 
                                       class="chat-input w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-2xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 pr-16 text-base"
                                       autocomplete="off"
                                       maxlength="1000">
                                <div class="absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center space-x-2">
                                    <span class="text-xs text-gray-400" id="char-counter">0/1000</span>
                                    <button type="button" class="w-6 h-6 bg-transparent rounded-full flex items-center justify-center hover:bg-gray-200 transition-all duration-300" title="Templates">
                                        <i class="fas fa-file-medical text-xs text-gray-400 hover:text-blue-500 transition-colors duration-300"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <button type="submit" 
                                    id="send-button"
                                    class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-full flex items-center justify-center hover:shadow-lg transform hover:scale-105 active:scale-95 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                                <i class="fas fa-paper-plane text-lg"></i>
                            </button>
                        </form>
                        
                        <!-- Professional Quick Replies -->
                        <div class="flex flex-wrap gap-2 mt-4">
                            <button class="quick-reply-btn px-3 py-2 bg-blue-100 text-blue-700 rounded-full text-sm hover:bg-blue-500 hover:text-white transition-all duration-300 transform hover:scale-105" data-message="Thank you for reaching out. How can I help you today?">
                                <i class="fas fa-stethoscope mr-1"></i>How can I help?
                            </button>
                            <button class="quick-reply-btn px-3 py-2 bg-green-100 text-green-700 rounded-full text-sm hover:bg-green-500 hover:text-white transition-all duration-300 transform hover:scale-105" data-message="I understand your concern. Let me review your case.">
                                <i class="fas fa-check-circle mr-1"></i>I understand
                            </button>
                            <button class="quick-reply-btn px-3 py-2 bg-purple-100 text-purple-700 rounded-full text-sm hover:bg-purple-500 hover:text-white transition-all duration-300 transform hover:scale-105" data-message="Let's schedule a follow-up appointment to discuss this further.">
                                <i class="fas fa-calendar-plus mr-1"></i>Schedule Follow-up
                            </button>
                            <button class="quick-reply-btn px-3 py-2 bg-orange-100 text-orange-700 rounded-full text-sm hover:bg-orange-500 hover:text-white transition-all duration-300 transform hover:scale-105" data-message="Please provide more details about your symptoms.">
                                <i class="fas fa-question-circle mr-1"></i>More Details
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="mt-6 professional-card rounded-xl p-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-center">
                <div class="bg-blue-50 rounded-lg p-3">
                    <div class="text-2xl font-bold text-blue-600" id="message-count">6</div>
                    <div class="text-sm text-gray-600">Total Messages</div>
                </div>
                <div class="bg-green-50 rounded-lg p-3">
                    <div class="text-2xl font-bold text-green-600" id="sent-count">2</div>
                    <div class="text-sm text-gray-600">Sent Today</div>
                </div>
                <div class="bg-purple-50 rounded-lg p-3">
                    <div class="text-2xl font-bold text-purple-600" id="received-count">4</div>
                    <div class="text-sm text-gray-600">Received Today</div>
                </div>
                <div class="bg-yellow-50 rounded-lg p-3">
                    <div class="text-sm font-semibold text-yellow-800" id="last-action">Ready to respond</div>
                    <div class="text-sm text-gray-600">Status</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let messageCount = 6;
        let sentCount = 2;
        let receivedCount = 4;
        let isSending = false;
        let isConnected = true;

        // DOM elements
        const chatForm = document.getElementById('chat-form');
        const messageInput = document.getElementById('message-input');
        const messagesContainer = document.getElementById('messages-container');
        const sendButton = document.getElementById('send-button');
        const charCounter = document.getElementById('char-counter');
        const typingIndicator = document.getElementById('typing-indicator');

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… Practitioner chat interface loaded');
            updateLastAction('Ready to respond');
            
            // Focus on input
            messageInput.focus();
            
            // Scroll to bottom
            scrollToBottom();
        });

        // Character counter
        messageInput.addEventListener('input', function() {
            const length = this.value.length;
            charCounter.textContent = `${length}/1000`;
            charCounter.className = length > 900 ? 'text-xs text-red-500' : 'text-xs text-gray-400';
        });

        // Form submission handler
        chatForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!messageInput || !isConnected || isSending) {
                console.log('âš ï¸ Cannot send: form not ready or already sending');
                return;
            }

            const message = messageInput.value.trim();
            
            if (!message) {
                console.log('âš ï¸ Cannot send empty message');
                return;
            }
            
            if (message.length > 1000) {
                showNotification('Message too long (max 1000 characters)', 'error');
                return;
            }
            
            console.log('ðŸ“¤ Practitioner sending message:', message.substring(0, 50) + '...');
            
            // Store original button content and disable form
            const originalButtonContent = sendButton.innerHTML;
            sendButton.disabled = true;
            sendButton.innerHTML = '<i class="fas fa-spinner fa-spin text-lg"></i>';
            sendButton.classList.add('send-pulse');
            
            // Clear input immediately to prevent double sending
            const messageToSend = message;
            messageInput.value = '';
            charCounter.textContent = '0/1000';
            charCounter.className = 'text-xs text-gray-400';
            
            // Simulate sending
            isSending = true;
            updateLastAction('Sending response...');
            
            try {
                // Add message to UI
                addMessage(true, messageToSend);
                
                // Simulate network delay
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Simulate success
                showNotification('Response sent to patient', 'success');
                updateLastAction('Response sent successfully');
                
                // Simulate patient response (sometimes)
                if (Math.random() > 0.5) {
                    setTimeout(() => {
                        showTyping();
                        setTimeout(() => {
                            hideTyping();
                            const responses = [
                                "Thank you doctor, that helps a lot.",
                                "I understand. When should I follow up?",
                                "Okay, I'll do that. Any other recommendations?",
                                "That makes sense. I feel better now.",
                                "I appreciate your help, doctor."
                            ];
                            const response = responses[Math.floor(Math.random() * responses.length)];
                            addMessage(false, response);
                            updateLastAction('Received patient response');
                        }, 2000);
                    }, 1000);
                }
                
            } catch (error) {
                console.error('âŒ Error sending message:', error);
                showNotification('Failed to send response', 'error');
                updateLastAction('Send failed');
                
                // Restore message to input on failure
                messageInput.value = messageToSend;
                charCounter.textContent = `${messageToSend.length}/1000`;
                charCounter.className = messageToSend.length > 900 ? 'text-xs text-red-500' : 'text-xs text-gray-400';
            } finally {
                // Re-enable form
                isSending = false;
                sendButton.disabled = false;
                sendButton.innerHTML = originalButtonContent;
                sendButton.classList.remove('send-pulse');
                
                // Focus back on input
                setTimeout(() => {
                    if (messageInput) {
                        messageInput.focus();
                    }
                }, 100);
            }
        });

        // Quick replies handler
        document.querySelectorAll('.quick-reply-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const message = this.getAttribute('data-message');
                if (message && !isSending && messageInput) {
                    console.log('ðŸ”„ Professional quick reply selected:', message);
                    messageInput.value = message;
                    messageInput.focus();
                    
                    // Update character counter
                    charCounter.textContent = `${message.length}/1000`;
                    charCounter.className = message.length > 900 ? 'text-xs text-red-500' : 'text-xs text-gray-400';
                    
                    // Auto-send quick replies after a short delay
                    setTimeout(() => {
                        if (chatForm && !isSending) {
                            const submitEvent = new Event('submit', { bubbles: true, cancelable: true });
                            chatForm.dispatchEvent(submitEvent);
                        }
                    }, 200);
                }
            });
        });

        // Enter key to send
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey && !isSending) {
                e.preventDefault();
                const submitEvent = new Event('submit', { bubbles: true, cancelable: true });
                chatForm.dispatchEvent(submitEvent);
            }
        });

        // Patient selection
        function selectPatient(name, avatar) {
            document.getElementById('patient-name').textContent = name;
            document.getElementById('patient-avatar').textContent = avatar;
            
            // Update active state
            document.querySelectorAll('.patient-item').forEach(item => {
                item.classList.remove('active', 'bg-blue-50', 'border-blue-500');
                item.classList.add('border-transparent');
            });
            
            event.currentTarget.classList.add('active', 'bg-blue-50', 'border-blue-500');
            event.currentTarget.classList.remove('border-transparent');
            
            updateLastAction(`Selected patient: ${name}`);
        }

        // Add message to UI
        function addMessage(isSent, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-item animate-slide-up ${isSent ? 'flex justify-end' : 'flex justify-start'}`;
            
            const currentTime = new Date().toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: 'numeric', 
                hour12: true 
            });

            const bubbleClass = isSent 
                ? 'practitioner-sent text-white rounded-2xl rounded-br-md px-4 py-3 shadow-lg'
                : 'patient-received rounded-2xl rounded-bl-md px-4 py-3 shadow-sm';

            messageDiv.innerHTML = `
                <div class="max-w-xs lg:max-w-md">
                    <div class="${bubbleClass}">
                        <p class="text-sm leading-relaxed break-words">${escapeHtml(content)}</p>
                    </div>
                    <div class="flex ${isSent ? 'justify-end' : 'justify-start'} mt-1 items-center space-x-1">
                        <span class="text-xs text-gray-500">${currentTime}</span>
                        ${isSent ? '<i class="fas fa-check-double message-read text-xs" title="Read"></i>' : ''}
                    </div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
            
            messageCount++;
            if (isSent) {
                sentCount++;
            } else {
                receivedCount++;
            }
            updateCounters();
        }

        // Show/hide typing indicator
        function showTyping() {
            typingIndicator.classList.remove('hidden');
            scrollToBottom();
            updateLastAction('Patient is typing...');
        }

        function hideTyping() {
            typingIndicator.classList.add('hidden');
        }

        // Utility functions
        function scrollToBottom() {
            messagesContainer.scrollTo({
                top: messagesContainer.scrollHeight,
                behavior: 'smooth'
            });
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }

        function updateCounters() {
            document.getElementById('message-count').textContent = messageCount;
            document.getElementById('sent-count').textContent = sentCount;
            document.getElementById('received-count').textContent = receivedCount;
        }

        function updateLastAction(action) {
            document.getElementById('last-action').textContent = action;
            console.log(`ðŸ”§ Practitioner Status: ${action}`);
        }

        function showNotification(message, type = 'info') {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                info: 'fa-info-circle'
            };
            
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-4 rounded-xl shadow-2xl z-50 transform translate-x-full transition-all duration-300`;
            notification.innerHTML = `
                <div class="flex items-center space-x-3">
                    <i class="fas ${icons[type]} text-lg"></i>
                    <span class="font-medium">${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => notification.style.transform = 'translateX(0)', 100);
            
            // Animate out and remove
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>